services:
  anki:
    image: thisisnttheway/headless-anki:latest
    container_name: anki-headless
    environment:
      QT_QPA_PLATFORM: offscreen
      ANKICONNECT_WILDCARD_ORIGIN: "1"
    volumes:
      - anki-data:/data
    ports:
      - "8765:8765"
    restart: unless-stopped
    mem_limit: 512m

  portal:
    build: .
    container_name: spelling-portal
    environment:
      ANKI_CONNECT_URL: http://anki:8765
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      AZURE_TTS_KEY: ${AZURE_TTS_KEY}
      AZURE_TTS_REGION: ${AZURE_TTS_REGION}
      NANO_BANANA_API_KEY: ${NANO_BANANA_API_KEY}
    ports:
      - "3000:3000"
    depends_on:
      - anki
    restart: unless-stopped

volumes:
  anki-data:
